services:
  claude-sandbox:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: claude-sandbox
    stdin_open: true    # Allocate stdin for interactive exec sessions
    tty: true           # Allocate a TTY for terminal colors and input

    # Load secrets from .env file
    env_file:
      - .env

    ports:
      # MCP bridge OAuth/HTTP server
      - "3000:3000"

    volumes:
      # Mount your project files (this is the ONLY host directory visible)
      - ./:/workspace

      # Mount SSH keys for Git push/pull (read-only for safety)
      - ~/.ssh:/root/.ssh:ro

      # Persist Claude Code config between container restarts
      - claude-config:/root/.claude

    # Resource limits (prevents runaway processes)
    deploy:
      resources:
        limits:
          memory: 4G
          cpus: "2.0"

volumes:
  claude-config:
