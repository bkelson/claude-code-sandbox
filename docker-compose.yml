services:
  claude-sandbox:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: claude-sandbox
    stdin_open: true    # Required for interactive Claude Code sessions
    tty: true           # Required for terminal colors and input

    # Load secrets from .env file
    env_file:
      - .env

    ports:
      # MCP bridge OAuth/HTTP server
      - "3000:3000"

    volumes:
      # Mount your project files (this is the ONLY host directory visible)
      - ./:/workspace

      # Mount SSH keys for Git push/pull (read-only for safety)
      - ~/.ssh:/root/.ssh:ro

      # Persist Claude Code config between container restarts
      - claude-config:/root/.claude

    # Network: only allow outbound to necessary services
    # Uncomment the network section below for stricter isolation
    # networks:
    #   - sandbox-net

    # Resource limits (optional, prevents runaway processes)
    deploy:
      resources:
        limits:
          memory: 4G
          cpus: "2.0"

# Persist Claude Code configuration across restarts
volumes:
  claude-config:

# Uncomment for network isolation (advanced)
# networks:
#   sandbox-net:
#     driver: bridge
